<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LLM Usage</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; line-height: 1.5; }
    main { max-width: 60rem; margin: 0 auto; }
    nav a { margin-right: 1rem; text-decoration: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 0.75rem; }
    th, td { text-align: left; padding: 0.4rem 0.6rem; border-bottom: 1px solid #ccc; }
    th { font-weight: 600; }
    .section { margin-top: 1.5rem; }
    .muted { color: #555; font-size: 0.9rem; }
  </style>
</head>
<body>
  <main>
    <nav>
      <a href="/index.html">Home</a>
      <a href="/write.html">Write</a>
      <a href="/lang.html">Runs</a>
      <a href="/queue.html">Queue</a>
    </nav>

    <h1>LLM Usage</h1>
    <div id="status" class="muted"></div>

    <div class="section">
      <h2>All Time</h2>
      <div id="all-time"></div>
    </div>

    <div class="section">
      <h2>Daily</h2>
      <div id="daily"></div>
    </div>
  </main>

  <script>
    const statusEl = document.getElementById('status');
    const allTimeEl = document.getElementById('all-time');
    const dailyEl = document.getElementById('daily');

    function renderTable(container, rows, columns) {
      if (!rows.length) {
        container.textContent = 'No usage yet.';
        return;
      }
      const table = document.createElement('table');
      const header = document.createElement('tr');
      columns.forEach((col) => {
        const th = document.createElement('th');
        th.textContent = col.label;
        header.appendChild(th);
      });
      table.appendChild(header);

      rows.forEach((row) => {
        const tr = document.createElement('tr');
        columns.forEach((col) => {
          const td = document.createElement('td');
          td.textContent = row[col.key] ?? '';
          tr.appendChild(td);
        });
        table.appendChild(tr);
      });

      container.textContent = '';
      container.appendChild(table);
    }

    async function loadUsage() {
      statusEl.textContent = 'Loading...';
      try {
        const res = await fetch('/api/usage');
        if (!res.ok) throw new Error('Failed to load usage');
        const data = await res.json();
        statusEl.textContent = '';
        renderTable(allTimeEl, data.all_time || [], [
          { key: 'model', label: 'Model' },
          { key: 'tokens_in', label: 'Tokens In' },
          { key: 'tokens_out', label: 'Tokens Out' },
          { key: 'total_tokens', label: 'Total Tokens' },
        ]);
        renderTable(dailyEl, data.daily || [], [
          { key: 'usage_date', label: 'Date' },
          { key: 'model', label: 'Model' },
          { key: 'tokens_in', label: 'Tokens In' },
          { key: 'tokens_out', label: 'Tokens Out' },
          { key: 'total_tokens', label: 'Total Tokens' },
        ]);
      } catch (err) {
        statusEl.textContent = `Error: ${err.message}`;
      }
    }

    loadUsage();
  </script>
</body>
</html>
