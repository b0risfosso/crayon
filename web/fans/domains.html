<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fantasiagenesis — Domains</title>
<meta name="color-scheme" content="light dark"/>
<style>
:root{--bg:Canvas;--fg:CanvasText;--line:color-mix(in oklab,var(--fg) 14%,transparent);--card:color-mix(in oklab,var(--bg) 95%,var(--fg) 5%);--chip:color-mix(in oklab,var(--fg) 8%,transparent);--accent:color-mix(in oklab,var(--fg) 22%,transparent);--r:14px}
*{box-sizing:border-box} body{margin:0;font:15px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--fg)}
header{padding:18px clamp(14px,4vw,28px);border-bottom:1px solid var(--line);display:grid;gap:8px}
h1{margin:0;font-size:clamp(1.1rem,2.6vw,1.6rem)}
.small{font-size:.9rem;opacity:.8}
.toolbar{display:flex;gap:.6rem;flex-wrap:wrap}
.input{display:flex;align-items:center;gap:.5rem;border:1px solid var(--line);border-radius:10px;padding:.45rem .6rem;background:var(--bg);min-width:260px}
.input input{all:unset;width:240px}
main{padding:18px clamp(14px,4vw,28px);display:grid;gap:12px;max-width:1100px;margin:0 auto}
.grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:12px}
.card h3{margin:.2rem 0 .3rem;font-size:1rem}
a.tile{display:block;color:inherit;text-decoration:none}
a.tile:focus-visible{outline:2px solid var(--accent);outline-offset:3px;border-radius:10px}
.row{display:flex;justify-content:space-between;align-items:center}
.chip{display:inline-flex;gap:.35rem;align-items:center;padding:.16rem .52rem;border-radius:999px;background:var(--chip);font-size:.78rem}
.empty{border:2px dashed var(--line);border-radius:12px;padding:18px;text-align:center;opacity:.8}
</style>
</head>
<body>
<header>
  <h1>Domains</h1>
  <div class="small">Click a domain to see its dimensions.</div>
  <div class="toolbar">
    <label class="input" title="Filter by title">
      <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 5 1.5-1.5zM4 9.5C4 6.46 6.46 4 9.5 4S15 6.46 15 9.5 12.54 15 9.5 15 4 12.54 4 9.5"/></svg>
      <input id="q" placeholder="Filter domains…"/>
    </label>
    <span class="chip"><span id="count">0</span> total</span>
  </div>
</header>
<main>
  <div id="list" class="grid" role="list"></div>
  <div id="empty" class="empty" hidden>No domains found.</div>
</main>
<script>
(async function(){
  const $q=document.getElementById('q'), $list=document.getElementById('list'), $count=document.getElementById('count'), $empty=document.getElementById('empty');
  let DATA=[];
  const fetchJSON=async(u)=>{const r=await fetch(u,{headers:{'Accept':'application/json'}}); if(!r.ok) throw new Error(u+' -> '+r.status); return r.json();};
  function card(n){
    const a=document.createElement('a'); a.className='tile card'; a.href=`dimensions.html?narrative_id=${encodeURIComponent(n.id)}&title=${encodeURIComponent(n.title)}`;
    a.setAttribute('role','listitem');
    a.innerHTML=`<div class="row"><h3>${esc(n.title)}</h3><span class="chip">#${n.id}</span></div><div class="small">Created: ${esc(n.created_at||'')}</div>`;
    return a;
  }
  function esc(s) {
  return (s ?? '')
    .toString()
    .replaceAll('&', '&amp;')
    .replaceAll('<', '&lt;')
    .replaceAll('>', '&gt;')
    .replaceAll('"', '&quot;')
    .replaceAll("'", '&#39;');
}

  function render(items){
    $list.innerHTML=''; if(!items.length){$empty.hidden=false;$count.textContent='0';return;}
    $empty.hidden=true; const f=document.createDocumentFragment(); items.forEach(n=>f.appendChild(card(n))); $list.appendChild(f); $count.textContent=String(items.length);
  }
  function filter(){ const t=($q.value||'').toLowerCase().trim(); if(!t) return render(DATA); render(DATA.filter(n=>String(n.title||'').toLowerCase().includes(t))); }
  $q.addEventListener('input', filter);
  try { DATA = await fetchJSON('/api/narratives'); render(DATA); } catch(e){ console.error(e); $empty.hidden=false; $empty.textContent='Failed to load domains.'; }
})();
</script>
</body>
</html>
