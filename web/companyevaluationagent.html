<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Backbone Lookup</title>
<style>
  :root { color-scheme: light dark; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
  h1 { font-size: 1.1rem; margin: 0 0 1rem; }
  form { display: flex; gap: .5rem; flex-wrap: wrap; align-items: center; margin-bottom: .5rem; }
  input[type="text"] { padding: .6rem .7rem; min-width: 18rem; border: 1px solid #ccc; border-radius: .5rem; }
  button { padding: .6rem .9rem; border: 0; border-radius: .5rem; cursor: pointer; background: #0b5cff; color: #fff; }
  #status { font-size: .9rem; margin: .5rem 0 0; min-height: 1.2em; opacity: .85; }
  pre { margin-top: .75rem; padding: .75rem; background: rgba(0,0,0,.05); border-radius: .5rem; overflow: auto; }
</style>
</head>
<body>
  <h1>Backbone Lookup</h1>

  <form id="f">
    <input id="q" type="text" placeholder="e.g., Apple, Meta, Spotify" required autofocus />
    <button type="submit">Fetch Backbone</button>
  </form>

  <div id="status"></div>
  <pre id="out">{}</pre>

<script>
(() => {
  const $ = s => document.querySelector(s);
  const form = $("#f"), input = $("#q"), out = $("#out"), status = $("#status");

  const api = (path, params) => {
    const u = new URL(path, window.location.origin);
    Object.entries(params || {}).forEach(([k,v]) => u.searchParams.set(k, v));
    return u.toString();
  };
  const pretty = obj => JSON.stringify(obj, null, 2);

  async function fetchJson(url, {signal} = {}) {
    const res = await fetch(url, { credentials: "include", signal });
    const text = await res.text();
    try {
      const data = JSON.parse(text);
      if (!res.ok) throw Object.assign(new Error(data?.detail || res.statusText), { status: res.status, data });
      return data;
    } catch {
      throw Object.assign(new Error("Non-JSON response"), { status: res.status, raw: text });
    }
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = input.value.trim(); if (!name) return;
    status.textContent = "Fetchingâ€¦"; out.textContent = "{}";

    const ctl = new AbortController();
    const t = setTimeout(() => ctl.abort(), 20000);

    try {
      const url = api("/api/backbone", { company_name: name });
      const data = await fetchJson(url, { signal: ctl.signal });
      out.textContent = pretty({ query: name, backbone: data });
      status.textContent = "Done.";
    } catch (err) {
      out.textContent = pretty({ error: err?.message || "Request failed", detail: err?.data?.detail ?? err?.raw ?? null });
      status.textContent = "Failed.";
    } finally {
      clearTimeout(t);
    }
  });

  input.addEventListener("keydown", (e) => { if (e.key === "Enter") form.requestSubmit(); });
})();
</script>
</body>
</html>
