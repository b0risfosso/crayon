<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minting Organism — Living Money Greenhouse</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#121922; --ink:#d2e3f5; --muted:#90a3b6; --accent:#7fe7ff;
      --good:#3bd16f; --warn:#ffbe3b; --bad:#ff5c7a; --leaf:#c8ffd0; --vine:#5aa382; --gold:#ffd166;
    }
    html,body{height:100%;}
    body{margin:0;background:radial-gradient(1200px 800px at 70% 20%, #0f1722 0%, var(--bg) 60%);
         color:var(--ink); font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid #1e2936;background:#0f1620bb;backdrop-filter: blur(4px);position:sticky;top:0;z-index:5}
    header h1{font-size:18px;margin:0;letter-spacing:.3px;font-weight:650}
    header .badges{display:flex;gap:8px;align-items:center}
    .badge{font-size:12px;padding:3px 8px;border-radius:999px;background:#0c3446;color:var(--accent);border:1px solid #164557}

    .grid{display:grid;grid-template-columns: 320px 1fr 300px; gap:12px; padding:12px;}

    /* Panels */
    .panel{background:linear-gradient(180deg, #0e151f, #0a1119); border:1px solid #172233; border-radius:14px; padding:12px; box-shadow:0 10px 30px #0008;}
    .panel h2{margin:0 0 10px 0; font-size:14px; text-transform:uppercase; letter-spacing:.12em; color:#a9bed2}

    /* Controls */
    .control{margin:10px 0}
    .control label{display:flex; justify-content:space-between; font-size:12px; color:var(--muted)}
    .control input[type=range]{width:100%}
    .toggle{display:flex; align-items:center; gap:8px; margin:8px 0}
    .toggle input{accent-color:var(--accent)}
    .btnrow{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
    button{background:#132131; color:var(--ink); border:1px solid #1d2e43; padding:8px 10px; border-radius:10px; cursor:pointer}
    button:hover{border-color:#2a435f}
    .small{font-size:12px; opacity:.85}

    /* Greenhouse */
    .greenhouse-wrap{position:relative; overflow:hidden; border-radius:14px;}
    .greenhouse{position:relative; height:68vh; min-height:520px; background: radial-gradient(800px 500px at 50% 10%, #122034 0%, #0a121c 55%, #081117 100%);
      border:1px solid #172233; border-radius:14px;}
    .dome{position:absolute; inset:0; pointer-events:none}
    .dome svg{width:100%; height:100%; opacity:.25}

    /* Soil */
    .soil{position:absolute; left:0; right:0; bottom:0; height:120px; background:linear-gradient(180deg,#0b0f14 0%, #0a0f12 45%, #080c0e 100%); border-top:1px solid #15202c}
    .soil:before{content:""; position:absolute; inset:0; background:radial-gradient(400px 100px at 30% 0%, #20334144, transparent 70%), radial-gradient(400px 100px at 70% 0%, #20334144, transparent 70%)}

    /* Ledger */
    .stat{display:grid; grid-template-columns: 1fr auto; gap:6px; margin:6px 0;}
    .stat .v{font-weight:700}
    .pill{display:inline-flex; gap:6px; align-items:center; border:1px solid #22405a; border-radius:999px; padding:4px 8px;}

    /* SVG scene */
    svg.scene{position:absolute; inset:0; overflow:visible}
    .vine{stroke:var(--vine); stroke-width:3; fill:none; filter: drop-shadow(0 4px 8px #032b23aa)}
    .leaf{fill: url(#leafGrad); stroke:#89d3a1; stroke-width:1}
    .leaf.brittle{fill: url(#leafBrittle); stroke:#699ba1}
    .leaf:hover{filter: drop-shadow(0 0 14px #aaffcc55)}
    .pollen{fill:#ffe7a1; opacity:.8}

    /* Falling leaves */
    .fall{animation: fall 6s linear forwards}
    @keyframes fall{
      0%{ transform: translate(0,0) rotate(0deg)}
      50%{ transform: translate(-20px,160px) rotate(30deg)}
      100%{ transform: translate(40px,280px) rotate(-25deg); opacity:.9}
    }

    /* Info tooltip */
    .tooltip{position:absolute; pointer-events:none; background:#0d1622; border:1px solid #203146; padding:8px 10px; border-radius:10px; font-size:12px; color:#cfe7ff; transform:translate(-50%, -120%); white-space:nowrap; display:none}

    /* Harvest tray */
    .harvest{min-height:120px; display:grid; grid-template-columns: repeat(6, 1fr); gap:8px}
    .tile{height:42px; border-radius:8px; background:linear-gradient(180deg,#0e1723,#0a141d); border:1px dashed #1e3146; display:flex; align-items:center; justify-content:center; font-size:12px; color:#bcd1e4}

    /* Log */
    .log{height:180px; overflow:auto; font-family:ui-monospace, SFMono-Regular, Menlo, monospace; background:#0b1119; border:1px solid #162133; border-radius:10px; padding:8px}
    .log .line{opacity:.9}
    .log .line .t{color:#7aa8ff}
    .log .line .tag{color:#9dd8b5}

    .legend{display:flex; gap:10px; flex-wrap:wrap; opacity:.8; font-size:12px}
    .legend span{display:inline-flex; align-items:center; gap:6px}
    .dot{width:10px; height:10px; border-radius:50%}
    .dot.leaf{background:linear-gradient(180deg,#bfffd1,#67e3a0)}
    .dot.pollen{background:#ffe7a1}
    .dot.pred{background:var(--bad)}
    .dot.sym{background:var(--good)}

    footer{padding:10px 14px; color:#a9bed2; opacity:.85}
    a{color:var(--accent)}
  </style>
</head>
<body>
  <header>
    <h1>Minting Organism — Living Money Greenhouse</h1>
    <div class="badges">
      <span class="badge">Money as Growth</span>
      <span class="badge">Photosynthetic Economics</span>
      <span class="badge">Play to Learn</span>
    </div>
  </header>

  <div class="grid">
    <!-- Controls -->
    <section class="panel" aria-label="Controls">
      <h2>Inputs</h2>
      <div class="control">
        <label>Sunlight (recognition)<span id="sunV">1.0</span></label>
        <input id="sun" type="range" min="0" max="2" step="0.01" value="1" />
      </div>
      <div class="control">
        <label>Water (effort)<span id="waterV">1.0</span></label>
        <input id="water" type="range" min="0" max="2" step="0.01" value="1" />
      </div>
      <div class="control">
        <label>Minerals (ideas/skills)<span id="minV">1.0</span></label>
        <input id="minerals" type="range" min="0" max="2" step="0.01" value="1" />
      </div>
      <div class="control">
        <label>CO₂ (needs/desires)<span id="co2V">1.0</span></label>
        <input id="co2" type="range" min="0" max="2" step="0.01" value="1" />
      </div>

      <div class="toggle"><input id="tradeWinds" type="checkbox" checked /><label for="tradeWinds">Trade Winds (circulate exchanges)</label></div>
      <div class="toggle"><input id="symbionts" type="checkbox" /><label for="symbionts">Symbionts (shade / shelter / data)</label></div>
      <div class="toggle"><input id="predators" type="checkbox" checked /><label for="predators">Predators (decay if imbalanced)</label></div>

      <div class="btnrow">
        <button id="mirrors">Sunlight Sculpting</button>
        <button id="prune">Prune Overgrowth</button>
        <button id="seed">Plant New Vine</button>
        <button id="reset" class="small">Reset</button>
      </div>

      <p class="small" style="margin-top:10px; color:#b7cadc">Hint: balance inputs for harmony. Imbalance grows brittle leaves (low value). Diversity and fair trade attract pollinators and raise yield.</p>
    </section>

    <!-- Greenhouse world -->
    <section class="panel greenhouse-wrap" aria-label="Greenhouse">
      <div class="greenhouse" id="greenhouse">
        <div class="dome" aria-hidden="true">
          <svg viewBox="0 0 1200 700" preserveAspectRatio="none">
            <defs>
              <radialGradient id="leafGrad" cx="50%" cy="0%" r="120%">
                <stop offset="0%" stop-color="#dfffe8"/>
                <stop offset="100%" stop-color="#7ae3a2"/>
              </radialGradient>
              <radialGradient id="leafBrittle" cx="50%" cy="0%" r="120%">
                <stop offset="0%" stop-color="#d0f6ff"/>
                <stop offset="100%" stop-color="#8ec4cc"/>
              </radialGradient>
              <filter id="glow"><feGaussianBlur stdDeviation="2" result="g"/><feMerge><feMergeNode in="g"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
            </defs>
            <!-- Subtle dome ribs -->
            <g stroke="#88b0d433" stroke-width="1" fill="none">
              <path d="M0 640 C 300 100, 900 100, 1200 640" />
              <path d="M0 660 C 300 140, 900 140, 1200 660" />
              <path d="M0 680 C 300 180, 900 180, 1200 680" />
            </g>
          </svg>
        </div>
        <svg class="scene" viewBox="0 0 1200 700" preserveAspectRatio="none" id="scene"></svg>
        <div class="soil"></div>
        <div id="tooltip" class="tooltip"></div>
      </div>
      <div style="margin-top:10px" class="legend">
        <span><span class="dot leaf"></span>Currency leaf</span>
        <span><span class="dot pollen"></span>Pollen micro‑transactions</span>
        <span><span class="dot pred"></span>Predator pressure</span>
        <span><span class="dot sym"></span>Symbiont boost</span>
      </div>
    </section>

    <!-- Ledger & Log -->
    <section class="panel" aria-label="Ledger">
      <h2>Ledger</h2>
      <div class="stat"><div>Leaves minted</div><div class="v" id="minted">0</div></div>
      <div class="stat"><div>Wallet value</div><div class="v" id="wallet">0.00</div></div>
      <div class="stat"><div>Harmony (0–1)</div><div class="v" id="harmony">0.50</div></div>
      <div class="stat"><div>Diversity</div><div class="v" id="diversity">—</div></div>
      <div class="stat"><div>Stability</div><div class="v" id="stability">—</div></div>
      <div class="stat"><div>Fair trade index</div><div class="v" id="fair">—</div></div>

      <div style="margin:8px 0 6px" class="pill"><span style="width:10px;height:10px;border-radius:50%;background:var(--good)"></span> <b id="stateTag">Prospering</b></div>

      <h2 style="margin-top:16px">Harvest</h2>
      <div class="harvest" id="harvest"></div>

      <h2 style="margin-top:16px">Event Log</h2>
      <div class="log" id="log" role="log" aria-live="polite"></div>
    </section>
  </div>

  <footer>
    <strong>How to play:</strong> Breathe balance into the world. Tune inputs until <em>Harmony</em> climbs; enable Trade Winds for circulation. Click leaves to inspect lineage. Use <em>Mirrors</em> to briefly focus sunlight, <em>Prune</em> to reset overgrowth, <em>Seed</em> to add a vine. Imbalance invites predators (decay); diversity and fair exchanges evolve better traits.
  </footer>

  <script>
  // ————————————————————————————
  // Utility
  // ————————————————————————————
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  const rnd=(a,b)=>a+Math.random()*(b-a);
  const lerp=(a,b,t)=>a+(b-a)*t;
  const now=()=>performance.now()/1000;

  // Logger
  const logEl = document.getElementById('log');
  function log(tag,msg){
    const line = document.createElement('div');
    line.className='line';
    line.innerHTML = `<span class="t">${new Date().toLocaleTimeString()}</span> <span class="tag">[${tag}]</span> ${msg}`;
    logEl.prepend(line);
  }

  // Tooltip
  const tip=document.getElementById('tooltip');
  function showTip(x,y,html){ tip.style.left=x+"px"; tip.style.top=y+"px"; tip.innerHTML=html; tip.style.display='block'; }
  function hideTip(){ tip.style.display='none'; }

  // DOM refs
  const sunR = document.getElementById('sun');
  const waterR = document.getElementById('water');
  const minR = document.getElementById('minerals');
  const co2R = document.getElementById('co2');
  const tradeWindsC = document.getElementById('tradeWinds');
  const symbiontsC = document.getElementById('symbionts');
  const predatorsC = document.getElementById('predators');
  const scene = document.getElementById('scene');
  const harvestEl = document.getElementById('harvest');
  const mintedEl = document.getElementById('minted');
  const walletEl = document.getElementById('wallet');
  const harmonyEl = document.getElementById('harmony');
  const diversityEl = document.getElementById('diversity');
  const stabilityEl = document.getElementById('stability');
  const fairEl = document.getElementById('fair');
  const stateTag = document.getElementById('stateTag');

  // value mirrors
  const valEls={sunV:document.getElementById('sunV'), waterV:document.getElementById('waterV'), minV:document.getElementById('minV'), co2V:document.getElementById('co2V')};
  function reflectRanges(){
    valEls.sunV.textContent=Number(sunR.value).toFixed(2);
    valEls.waterV.textContent=Number(waterR.value).toFixed(2);
    valEls.minV.textContent=Number(minR.value).toFixed(2);
    valEls.co2V.textContent=Number(co2R.value).toFixed(2);
  }
  [sunR,waterR,minR,co2R].forEach(r=>r.addEventListener('input',reflectRanges));
  reflectRanges();

  // ————————————————————————————
  // World State
  // ————————————————————————————
  const world={
    t: 0,
    vines: [],
    minted: 0,
    wallet: 0,
    fairness: 0.5,
    pollination: 0.5,
    diversity: 0.5,
    stability: 0.5,
    trait:{ liquidity:0.5, resilience:0.5, fairness:0.5 },
  };

  function inputs(){
    const s = Number(sunR.value), w=Number(waterR.value), m=Number(minR.value), c=Number(co2R.value);
    // Diversity: how balanced are the inputs? variance penalty
    const arr=[s,w,m,c];
    const mean = (s+w+m+c)/4;
    const variance = arr.reduce((a,v)=>a+(v-mean)*(v-mean),0)/4;
    const diversity = clamp(1-variance/1.5,0,1); // lower variance -> higher diversity
    // Harmony: supply vs demand (use s*w*m vs c) scaled
    const supply = Math.cbrt(Math.max(0.0001,s*w*m));
    const demand = Math.sqrt(c);
    const ratio = supply/(demand+1e-6);
    const harmony = clamp(1-Math.abs(Math.log(ratio)),0,1); // 1 if supply ~= demand

    return { s,w,m,c, diversity, harmony };
  }

  function updateIndices(inp){
    world.diversity = lerp(world.diversity, inp.diversity, 0.05);
    // Stability rises with diversity & moderate harmony; falls with extremes
    const stabilityTarget = clamp(0.2 + 0.6*inp.diversity + 0.2*inp.harmony,0,1);
    world.stability = lerp(world.stability, stabilityTarget, 0.03);
    // Fairness follows trade winds + symbionts + harmony
    const fairTarget = clamp(0.3 + 0.4*(tradeWindsC.checked?1:0) + 0.2*(symbiontsC.checked?1:0) + 0.1*inp.harmony,0,1);
    world.fairness = lerp(world.fairness, fairTarget, 0.04);

    harmonyEl.textContent = world.harmony? world.harmony.toFixed(2): inp.harmony.toFixed(2);
    diversityEl.textContent = world.diversity.toFixed(2);
    stabilityEl.textContent = world.stability.toFixed(2);
    fairEl.textContent = world.fairness.toFixed(2);

    const score = world.harmony*0.4 + world.stability*0.3 + world.fairness*0.3;
    stateTag.textContent = score>0.7? 'Prospering' : score>0.45? 'Stable' : 'Stressed';
  }

  // ————————————————————————————
  // Vines & Leaves (SVG)
  // ————————————————————————————
  class Vine{
    constructor(x){
      this.x = x; this.y = 640; this.h = rnd(260, 360);
      this.group = document.createElementNS('http://www.w3.org/2000/svg','g');
      scene.appendChild(this.group);
      this.path = document.createElementNS('http://www.w3.org/2000/svg','path');
      this.path.setAttribute('class','vine');
      this.group.appendChild(this.path);
      this.leaves=[];
      this.phase=rnd(0,Math.PI*2);
      this.updatePath();
    }
    updatePath(){
      const segs=12; let d=`M ${this.x} ${this.y}`; const amp=30;
      for(let i=1;i<=segs;i++){
        const t=i/segs; const yy=this.y - this.h*t; const xx=this.x + Math.sin(this.phase+t*4)*amp*(1-t);
        d+=` L ${xx.toFixed(2)} ${yy.toFixed(2)}`;
      }
      this.path.setAttribute('d',d);
    }
    spawnLeaf(){
      const t=rnd(0.2,0.9); // along the vine
      const pt=this.pointAt(t);
      const leaf = new Leaf(pt.x, pt.y, (Math.random()<0.5? -1:1));
      this.group.appendChild(leaf.el);
      this.leaves.push(leaf);
      return leaf;
    }
    pointAt(t){
      // approximate using the path string segments
      const total= this.h; const yy=this.y - total*t; const xx=this.x + Math.sin(this.phase+t*4)*30*(1-t);
      return {x:xx,y:yy};
    }
    step(dt){
      this.phase+=dt*0.4; this.updatePath();
      // growth chance depends on harmony & diversity
      const g = 0.4*world.harmony + 0.3*world.diversity + 0.3*world.fairness;
      if(Math.random()< dt * (0.2 + 0.8*g)) this.spawnLeaf();

      // step leaves
      this.leaves = this.leaves.filter(l=>!l.dead);
      this.leaves.forEach(l=>l.step(dt));
    }
  }

  class Leaf{
    constructor(x,y,side){
      this.x=x; this.y=y; this.side=side; this.age=0; this.mature=false; this.dead=false; this.value=0;
      this.lineage = {
        gens: 1 + Math.floor(rnd(0,6)),
        nutrients: { s:Number(sunR.value), w:Number(waterR.value), m:Number(minR.value), c:Number(co2R.value) },
        fairness: world.fairness.toFixed(2)
      };
      this.brittle=false;
      this.el=document.createElementNS('http://www.w3.org/2000/svg','path');
      this.el.setAttribute('class','leaf');
      this.setPath(0);

      // hover tooltip
      this.el.addEventListener('mousemove', (e)=>{
        const h = `
          <div><b>Currency leaf</b></div>
          <div>Age: ${(this.age).toFixed(1)} s</div>
          <div>Value: <b>${this.value.toFixed(2)}</b></div>
          <div>Lineage: gens ${this.lineage.gens}</div>
          <div>Fairness at growth: ${this.lineage.fairness}</div>
        `; showTip(e.clientX, e.clientY, h);
      });
      this.el.addEventListener('mouseleave', hideTip);
    }
    setPath(scale){
      const w= 22*scale + 4, h= 12*scale + 2; const tilt = this.side*25;
      const d = `M ${this.x} ${this.y} q ${tilt} -10 ${w} 0 q ${-tilt} 10 ${-w} 0 z`;
      this.el.setAttribute('d', d);
    }
    step(dt){
      this.age += dt;
      const inp=inputs();
      // growth rate depends on harmony; quality on stability & fairness
      const g = clamp(0.2 + 1.2*inp.harmony + 0.3*world.trait.liquidity,0,2);
      const scale = clamp(this.age * (0.4 + g*0.6), 0, 1.5);
      this.setPath(scale);

      // become brittle if diversity is poor or predators active
      const pred = predatorsC.checked ? (1-inp.diversity) * 0.7 : 0;
      const brittleChance = clamp(pred + (inp.harmony<0.3?0.2:0) , 0, 0.9);
      if(!this.mature && Math.random()< dt * brittleChance){ this.brittle=true; this.el.classList.add('brittle'); }

      // mature & detach
      if(!this.mature && this.age> rnd(3,6)){
        this.mature=true;
        this.value = clamp( 1.0*inp.harmony + 0.6*world.stability + 0.7*world.fairness - (this.brittle?0.5:0), 0, 2.5);
        this.detach();
      }
    }
    detach(){
      // animate fall (CSS transform on a wrapper foreignObject for simplicity)
      const fo = document.createElementNS('http://www.w3.org/2000/svg','g');
      fo.appendChild(this.el);
      this.el.style.transformOrigin = `${this.x}px ${this.y}px`;
      this.el.classList.add('fall');
      this.el.addEventListener('animationend', ()=>this.harvest());
      this.dead=true;
    }
    harvest(){
      world.minted+=1; world.wallet += this.value; mintedEl.textContent=world.minted; walletEl.textContent=world.wallet.toFixed(2);
      const tile = document.createElement('div'); tile.className='tile'; tile.textContent = this.value.toFixed(2);
      harvestEl.prepend(tile); if(harvestEl.childElementCount>18) harvestEl.removeChild(harvestEl.lastChild);
      log('mint', `A leaf matured with value ${this.value.toFixed(2)} based on harmony, stability, fairness${this.brittle? ' (brittle)': ''}.`);
    }
  }

  // Pollen motes (microtransactions)
  function spawnPollen(){
    const motes = Math.floor(2 + 8*(tradeWindsC.checked?1:0)*world.fairness);
    for(let i=0;i<motes;i++){
      const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
      c.setAttribute('class','pollen');
      c.setAttribute('cx', rnd(100,1100));
      c.setAttribute('cy', rnd(80,480));
      c.setAttribute('r', rnd(1,2));
      c.style.opacity = rnd(0.5,0.9);
      scene.appendChild(c);
      // drift
      const dx = rnd(-60,60), dy=rnd(-40,40), dur=rnd(6,12);
      c.animate([{transform:'translate(0,0)'},{transform:`translate(${dx}px, ${dy}px)`}], {duration: dur*1000, fill:'forwards', easing:'linear'});
      setTimeout(()=>c.remove(), dur*1000+1000);
    }
  }

  // World setup
  function seedVine(x){ const v=new Vine(x); world.vines.push(v); log('seed','New vine rooted.'); return v; }

  function reset(){
    world.vines=[]; scene.innerHTML=''; harvestEl.innerHTML=''; world.minted=0; world.wallet=0; mintedEl.textContent='0'; walletEl.textContent='0.00';
    for(let i=0;i<3;i++) seedVine(260+i*260);
    log('reset','Greenhouse reset. Three vines established.');
  }

  // Buttons
  document.getElementById('mirrors').addEventListener('click',()=>{
    const boost = 0.25; const old = Number(sunR.value); sunR.value = clamp(old+boost, 0, 2); reflectRanges();
    log('mirror','Sunlight briefly focused (+0.25).');
    setTimeout(()=>{ sunR.value = old; reflectRanges(); log('mirror','Mirrors returned to neutral.'); }, 5000);
  });
  document.getElementById('prune').addEventListener('click',()=>{
    world.vines.forEach(v=>{ v.leaves.forEach(l=>{ if(!l.mature && Math.random()<0.6) l.mature=true; }); });
    log('prune','Overgrowth pruned; several leaves forced to mature.');
  });
  document.getElementById('seed').addEventListener('click',()=>{
    seedVine(rnd(140,1060));
  });
  document.getElementById('reset').addEventListener('click', reset);

  // Symbionts & Predators visual hints
  function pulseHint(color){
    const ring = document.createElementNS('http://www.w3.org/2000/svg','circle');
    ring.setAttribute('cx', rnd(200,1000)); ring.setAttribute('cy', rnd(120,520)); ring.setAttribute('r', rnd(40,80));
    ring.setAttribute('fill','none'); ring.setAttribute('stroke', color); ring.setAttribute('stroke-width','2'); ring.style.opacity='0.7';
    scene.appendChild(ring);
    ring.animate([{opacity:.7, strokeWidth:2},{opacity:0, strokeWidth:12}], {duration: 2000, fill:'forwards'});
    setTimeout(()=>ring.remove(), 2200);
  }

  symbiontsC.addEventListener('change',()=>{ if(symbiontsC.checked){ pulseHint('#54e58a'); log('symbiont','Alliances formed: shade/shelter/data boost.'); }});
  predatorsC.addEventListener('change',()=>{ if(predatorsC.checked){ pulseHint('#ff5c7a'); log('predator','Predator pressures active when imbalanced.'); }});

  // Main loop
  let lastT = now();
  function frame(){
    const t = now(); const dt = clamp(t - lastT, 0, 0.1); lastT = t; world.t += dt;
    const inp=inputs(); world.harmony = lerp(world.harmony||inp.harmony, inp.harmony, 0.05);
    updateIndices(inp);

    // evolution: traits gently move toward what works
    world.trait.liquidity = lerp(world.trait.liquidity, clamp(world.fairness*0.6 + world.harmony*0.4,0,1), 0.01);
    world.trait.resilience = lerp(world.trait.resilience, clamp(world.stability,0,1), 0.008);

    // periodic events
    if(tradeWindsC.checked && Math.random()<dt*0.6) spawnPollen();
    if(predatorsC.checked && inp.diversity<0.35 && Math.random()<dt*0.4){
      pulseHint('#ff5c7a');
      // decay some immature leaves
      const v = world.vines[Math.floor(Math.random()*world.vines.length)];
      if(v && v.leaves.length){ const l=v.leaves[Math.floor(Math.random()*v.leaves.length)]; if(l && !l.mature){ l.brittle=true; l.mature=true; log('decay','An imbalanced patch caused a brittle leaf to drop.'); }}
    }

    // step vines
    world.vines.forEach(v=>v.step(dt));
    requestAnimationFrame(frame);
  }

  // Start
  reset();
  requestAnimationFrame(frame);

  // Accessibility: keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if(e.key==='m') document.getElementById('mirrors').click();
    if(e.key==='p') document.getElementById('prune').click();
    if(e.key==='s') document.getElementById('seed').click();
    if(e.key==='r') document.getElementById('reset').click();
  });
  </script>
</body>
</html>
