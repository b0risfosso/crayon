<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fantasiagenesis — Narrative Dimensions</title>
  <style>
  :root { --bg:#f9fafb; --card:#fff; --text:#111827; --muted:#6b7280; --line:#e5e7eb; }
  body { font-family: system-ui, -apple-system, sans-serif; background:var(--bg); color:var(--text); margin:0; }
  header { position:sticky; top:0; background:var(--card); border-bottom:1px solid var(--line); padding:.75rem 1rem; display:flex; justify-content:space-between; align-items:center; }
  h1 { font-size:1.25rem; font-weight:700; margin:0; }
  main { max-width:64rem; margin:0 auto; padding:1rem; }
  .grid { display:grid; grid-template-columns:1fr; gap:1rem; }
  @media (min-width:640px){ .grid{ grid-template-columns:1fr 1fr; } }
  .card { background:var(--card); border:1px solid var(--line); border-radius:12px; padding:1rem 1.25rem; transition:transform .08s ease, box-shadow .08s ease; cursor:pointer; }
  .card:hover { transform:translateY(-2px); box-shadow:0 4px 14px rgba(0,0,0,.06); }
  .title { font-size:1rem; font-weight:600; margin-bottom:.5rem; }
  .desc { color:var(--muted); font-size:.9rem; margin-bottom:.25rem; white-space:pre-wrap; }
  .breadcrumb { color:var(--muted); margin:.25rem 0 1rem; }
  a.back { text-decoration:none; color:var(--muted); border:1px solid var(--line); padding:.35rem .6rem; border-radius:10px; }
  footer { color:var(--muted); margin-top:2rem; }
  </style>
</head>
<body>
  <header>
    <h1>fantasiagenesis</h1>
    <span style="color:#6b7280">narratives → dimensions</span>
  </header>

  <main>
    <p class="breadcrumb"><a class="back" href="./">← back to narratives</a></p>
    <div id="meta"></div>
    <section id="grid" class="grid" aria-live="polite"></section>
    <footer>© <span id="year"></span> fantasiagenesis.</footer>
  </main>

  <script>
    const qs = new URLSearchParams(location.search);
    const narrativeId = Number(qs.get('narrative') || '0');

    const api = {
      narrative: (id) => fetch(`/api/narratives/${id}`).then(r=>r.json()),
      dimensions: (id) => fetch(`/api/narrative-dimensions?narrative=${id}`).then(r=>r.json())
    };

    function renderMeta(n) {
      const meta = document.getElementById('meta');
      if (!n || !n.id) { meta.innerHTML = `<h2 class="title">Narrative not found</h2>`; return; }
      meta.innerHTML = `
        <h2 class="title">${n.id}. ${n.title}</h2>
        <p class="desc">${n.description || ''}</p>
      `;
    }

    function renderDimensions(items){
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      if (!items.length){
        grid.innerHTML = `<div class="card"><div class="desc">No dimensions yet for this narrative.</div></div>`;
        return;
      }
      items.forEach(d=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.addEventListener('click', ()=> {
          window.location.href = `narrative-seeds.html?dimension=${d.id}`;
        });
        card.innerHTML = `
          <h3 class="title">${d.id}. ${d.title}</h3>
          <p class="desc">${d.description || ''}</p>
        `;
        grid.appendChild(card);
      });
    }

    async function boot(){
      document.getElementById('year').textContent = new Date().getFullYear();
      if (!narrativeId){ renderMeta(null); renderDimensions([]); return; }
      try{
        const [n, dims] = await Promise.all([api.narrative(narrativeId), api.dimensions(narrativeId)]);
        renderMeta(n);
        renderDimensions(dims);
      } catch(e){
        console.error(e);
        renderMeta(null);
        renderDimensions([]);
      }
    }
    boot();
  </script>
</body>
</html>
